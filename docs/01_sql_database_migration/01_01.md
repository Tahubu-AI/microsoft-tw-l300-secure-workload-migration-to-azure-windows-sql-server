---
title: '1. Enable Azure Arc'
layout: default
nav_order: 1
parent: 'Exercise 01: SQL Migration to Azure via Arc MI-Link'
---

# Task 01 - Enable Azure Arc

## Introduction

Tailspin Toys is beginning the migration of its SQL Server workloads to Azure. To support hybrid replication and failover with MI‑Link, the company first needs to connect its on‑premises SQL Server VM to Azure using Azure Arc. By Arc‑enabling the VM, Tailspin can extend Azure management capabilities to its existing environment and prepare for seamless database migration to Azure SQL Managed Instance.

## Description

In this task, you will Arc‑enable the simulated on‑premises SQL Server VM. Azure Arc provides a bridge between on‑premises infrastructure and Azure services, allowing Tailspin Toys to manage, secure, and migrate workloads consistently. Once enabled, the SQL Server instance can participate in MI‑Link replication, enabling hybrid migration and high availability/disaster recovery scenarios.

The key tasks are as follows:

1. Connect to the `tailspin<uniqueid>-onprem-hyperv-vm` Virtual machine using Azure Bastion. This VM represents the Tailspin's on-premises SQL Server environment.
2. Install and configure Azure Arc on the VM to register it with Azure.
3. Install the Azure extension for SQL Server to connect the SQL Server to Arc.

## Success Criteria

- You have successfully connected to the SQL Server VM via Azure Bastion.
- The VM and SQL Server are Arc‑enabled and visible in the Azure portal under Azure Arc SQL servers.
- The SQL Server instance is ready to be linked with Azure SQL Managed Instance using MI‑Link in the next task.

## Solution

<details markdown="block">
<summary>Expand this section to view the solution</summary>

Considering using this approach...
<https://learn.microsoft.com/en-us/sql/sql-server/azure-arc/connect?view=sql-server-ver17&tabs=windows>

1. In the Azure Portal, navigate to the Resource Group for the lab and select the `tailspin<uniqueid>-onprem-hyperv-vm` virtual machine from the list of resources. This VM is the Hyper-V host containing the on-premises SQL Server VM.

    ![The Virtual machine pane for the Simulated on-premises SQL Server VM is shown in the Azure Portal.](../../Hands-on%20lab/images/azure-portal-onprem-hyperv-vm.png)

    {: .important }
    > In this lab, the "on‑premises" SQL Server VM is simulated using a Hyper‑V guest VM running inside Azure. This design choice is required because the Azure Arc Connected Machine agent cannot be installed directly on Azure VMs. By using a nested Hyper‑V guest, you can Arc‑enable the VM as if it were truly on‑premises, ensuring the lab environment accurately reflects a hybrid scenario. This configuration is intended only for demo and testing purposes and should not be used in a production environment.

2. Select **Bastion** under **Connect** in the left navigation menu, and on the Bastion blade, enter the following username and password, ensure **Open in a new browser window** is checked, then select **Connect**.

    - **Username**: `demouser`
    - **Password**: `demo!pass123`

    ![The Bastion pane of the tailspin-onprem-sql-vm Virtual machine is shown with the Username and Password fields entered and highlighted.](../../Hands-on%20lab/images/sql-vm-connect-bastion.png)

3. If prompted to allow the browser to "see text and images copied to the clipboard," select **Allow**.

4. On the Hyper-V host VM, within the Bastion session, open **Hyper-V Manager** entering "hyper-v" into the search bar and selecting **Hyper-V Manager** in the result pane.

    ![The Hyper-V Manager application is shown.](../../Hands-on%20lab/images/hyper-v-manager-application.png "Hyper-V Manager")

5. In **Hyper-V Manager**, select **WINSERVER** from the list of resources on the right, then double-click **OnPremSqlVM** in the Virtual Machines list to connect to the VM.

    ![The Hyper-V Manager is shown with the on-premises SQL VM highlighted and right-click menu shown with the Connect option highlighted.](../../Hands-on%20lab/images/hyper-v-manager-onprem-sql-vm-connect.png)

6. In the **Virtual Machine Connection** window, log in to the VM using the following credentials:

    - **Username** = `Administrator`
    - **Password** = `JS123!!`

7. Once logged in to **OnPremSQLVM**, open a web browser and navigate to the [Azure portal](https://portal.azure.com/).

8. In the Azure portal, enter "azure arc" into the search bar, and select **Azure Arc** under **Services** in the results.

    ![The text "azure arc" is entered in the search box, and Azure Arc is highlighted under Services in the results.](../../Hands-on%20lab/images/azure-search-azure-arc.png)

9. On the Azure Arc blade, select **SQL servers** under **Data services** in the left menu, then select **Add** on the toolbar.

    ![SQL servers is highlighted under Data services in the left menu of the Arc blade, and Add is highlighted on the toolbar.](../../Hands-on%20lab/images/azure-arc-sql-servers-add.png)

10. On the **Add existing SQL Server instances** page, select **Connect SQL Server instances** in the **Connect SQL Server instances to Azure Arc** tile to create a new registration.

    ![Connect SQL Server instances is highlighted within the *Connect SQL Server instances to Azure Arc tile.](../../Hands-on%20lab/images/azure-arc-connect-sql-server-instances.png)

11. On the **Prerequistes** tab of the **Connect SQL Server enabled by Azure Arc** blade, review the prerequisites and ensure you have the required details, then select **Next: Server details**.

12. On the **Server details** tab, enter the following:

    - **Subscription**: Select your subscription
    - **Resource group**: Select the `rg-tw-tailspin-lab` resource group you created for this lab
    - **Region**: Select the region associated with your resource group
    - **Operating system**: Choose `Windows`
    - **Server Name**: Enter `OnPremSQLVM`
    - **License type**: Select `I want to license my production environment on this server with Enterprise or Standard edition pay-as-you-go ("PAYGO")`
    - Select **Next: Tags**

    ![The Server details tab is populated with the values specified above.](../../Hands-on%20lab/images/azure-arc-connect-sql-server-details.png)

13. On the **Tags** tab, select **Next: Run script**.

14. On the **Run script** tab, select **Download**. Alternatively, you can select the **Copy to clipboard** link, then paste the script into a file named `RegisterSqlServerArc.ps1` that you save to the SQL VM.

    ![The Download button and copy to clipboard icon are highlighted on the Connect SQL Server enabled by Azure Arc page.](../../Hands-on%20lab/images/azure-arc-connect-sql-server-run-script.png)

15. On the **OnPremSQLVM**, open PowerShell as an administrator.

    ![PowerShell is entered into the Windows search bar, Windows PowerShell is selected in the results, and Run as administrator is highlighted in the context menu.](../../Hands-on%20lab/images/sql-vm-start-search-powershell.png)

16. At the PowerShell prompt, change directories to the location where you saved the downloaded file.

    {: .note}
    > You can simplify the commands by coping the downloaded file to `C:\`.

17. Run the following command:

    ```powershell
    ./RegisterSqlServerArc.ps1
    ```

    ![The RegisterSqlServerArc.ps1 command in highlighted in the PowerShell dialog. The command output is displayed.](../../Hands-on%20lab/images/register-sql-server-arc.png)

18. When prompted, navigate to <https://microsoft.com/devicelogin>, enter the code provided in the PowerShell window, and follow the prompts to log into your Azure account.

19. The script will take several minutes to complete. It onboards SQL Server for Arc by installing the Azure Connected Machine Agent and the Azure Extension for SQL Server.

20. When the script completes, return to the Azure Arc **SQL servers** page in the Azure portal and verify you see the `OnPremSQLVM` server and databases.

    ![SQL Servers is highlighted under Data services on the Azure Arc page and the OnPremSQLVM server is highlighted in the list of SQL Servers.](../../Hands-on%20lab/images/azure-arc-sql-servers-instances.png)

</details>
