---
title: '1.  Prepare the Environment for Container Migration'
layout: default
nav_order: 1
parent: 'Exercise 02: Create a Container Migration'
---

# Task 01 - Prepare the Environment for Container Migration

## Introduction

Tailspin Toys wants to prepare their environment for container migration by installing the necessary tools and validate the connectivity and authentication with Azure.

## Description

After you complete this task, you will be able to: 

- Install prerequisites for container migration 
- Validate connectivity and authentication with Azure 

## Success Criteria

* Docker and Kubernetes CLI have installed correctly.
* Azure CLI isntalled correctly and successful authentication is confirmed.
* The clone of the repository at [repo](https://github.com/microsoft/Container-Migration-Solution-Accelerator) is successful.

## Solution

<details markdown="block">
<summary>Expand this section to view the solution</summary>

1. Sign in to the [Azure Portal](https://portal.azure.com). Ensure that you're using a subscription associated with the same resources you created during the Before the hands-on lab set up.

    {: .highlight }
    > If you're using Azure Gov, sign in to the [Azure Gov Portal](https://portal.azure.us).

2. Search for the resource group you created earlier and select the OnPrem Hyper-v VM that was deployed in the previous setup

3. Select the `Connect` blad in the left sidebar, then select `Bastion`

4. Enter the `Username` and `Password` under the Authentication type of `VM Password` and `Connect`

![Bastion Connect](../../Hands-on%20lab/images/02-BastionConnect.png)

5. Once the VM starts, open a Powershell instance in the VM

6. First let's start by installing the Azure CLI.  Execute the following command in Powershell :

```powershell
     $ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\AzureCLI.msi
```

7. After successful download, execute the installer on the VM:

```powershell
    Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet'; Remove-Item .\AzureCLI.msi
```

![AZ Install](../../Hands-on%20lab/images/02-AZ-Install.png)

8. After a successful install, restart the Powershell install and verify that AZ CLI was installed successfully on the VM by executing:

```powershell
    az version
```

![AZ Verify](../../Hands-on%20lab/images/02-AZ-Verify.png)

9. Next, you need to install Docker on the Hyper-V VM, but first you need to enable Hyper-V in case it is not already enabled.  From the a Powershell install on the Hyper-V VM execute the following command:

```powershell
       Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All 
```
10. Enable nested virtualization on the Hyper-V VM:

```powershell
        Set-VMProcessor -VMName "YourAzureVMName" -ExposeVirtualizationExtensions $true
```
Replace "YourAzureVMName" with the actual name of your Azure VM

11. Download Docker Desktop to your temp folder on the Hyper-V VM

```powershell
    $dockerInstallerPath = Join-Path $Env:Temp "DockerDesktopInstaller.exe"
    Invoke-WebRequest -Uri "https://desktop.docker.com/win/stable/amd64/Docker%20Desktop%20Installer.exe" -OutFile $dockerInstallerPath
```

![Docker Download](../../Hands-on%20lab/images/02-Docker-Download.png)

12. Install Docker Desktop on the Hyper-V VM from the temp folder

```powershell
    Start-Process -FilePath "<path_to_installer>\DockerDesktopInstaller.exe" -ArgumentList "install --quiet" -Wait -NoNewWindow
```

* This will take several minutes

![Docker Install](../../Hands-on%20lab/images/02-docker-install.png)

13. Verify Docker was installed correctly

```powershell
    docker info
```

14. Finally, you need to also install the Kubernetes CLI (kubectl) on the Hyper-V VM. Download the executable of kubectl:

```powershell
    winget install -e --id kubernetes.kubectl 
```

14. Add the executable to a folder already on the path or place it in a new folder and add that folder to your environment path on the Hyper-V VM

15. Verify that kubectl is installed correctly on your Hyper-V VM:

```powershell
    kubectl version --client
```

![Kubectl verify](../../Hands-on%20lab/images/02-kubectl-verify.png)

16. Install Visual Studio Code on the Hyper-V VM if it is not already installed. You can download it from [here](https://code.visualstudio.com/docs/setup/windows)

16. Clone the repo for `Container Migration Solution Accelerator` from GitHub on your Hyper-V VM.  The repo is available at [https://github.com/microsoft/Container-Migration-Solution-Accelerator.git](https://github.com/microsoft/Container-Migration-Solution-Accelerator.git).

![Repo clone](../../Hands-on%20lab/images/02-Repo-Clone.png)

</details>
